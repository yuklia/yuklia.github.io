[{"content":"AWS Global Infrastructure At the time of writing this note, The AWS Cloud spans â¬‡ï¸\n99 Availability Zones within 31 geographic regions around the world ğŸ’¡ with announced plans for 15 more Availability Zones and 5 more AWS Regions in Canada, Israel, Malaysia, New Zealand, and Thailand.\nAvailability Zones Data Centers Regions Edge Locations AWS Management Console ","permalink":"https://yuklia.github.io/posts/saa-c03/aws-fundamentals/","summary":"AWS Global Infrastructure At the time of writing this note, The AWS Cloud spans â¬‡ï¸\n99 Availability Zones within 31 geographic regions around the world ğŸ’¡ with announced plans for 15 more Availability Zones and 5 more AWS Regions in Canada, Israel, Malaysia, New Zealand, and Thailand.\nAvailability Zones Data Centers Regions Edge Locations AWS Management Console ","title":"Evening 1 // SAA-C03 :: AWS Fundamentals"},{"content":"What you will learn today ğŸ¦¦: what is Traefik and why I decisively recommend to use it with Docker Swarm how to show custom error page if Traefik returns 404 (service not found) How I met Traefik ğŸ˜ Traefik is a top modern reverse proxy and load balancer. I started to use it from major version 1. At that moment, I already had Docker Swarm cluster, which I began to prepare for production use, and only one thing in the coherent picture has been left: \u0026ldquo;External Load Balancer\u0026rdquo;. Official docker doc had an example with HaProxy so it was obvious to try it out first. As I remember it took a significant amount of time to get HaProxy works smoothly with Swarm. But I wasn\u0026rsquo;t satisfied with the result:\nstatic config which is needed to re-deploy in case of changes *.cfg not supports variables substitution (out of the box) no native support of Lets\u0026rsquo;s Encrypt The production deadline was getting close, but it was out of my religion to leave such an ugly solution. I was searching the Internet and bumped into Traefik. Integration was surprisingly fast and easy. I thought to myself: \u0026ldquo;That is how modern DevOps should look like\u0026rdquo;. It is been 3 years since I deal with Traefik, and today I wanna tell about one of the most much wished-for feature.\nStep by step setup ğŸŸ ğŸ’ ğŸ¦§ â¤´ï¸ ğŸ‘·ğŸ¼ error-midl Traefik v2.x comes to us with middlewares and ErrorPage one of them.\nLett\u0026rsquo;s assume:\ntraefik dasboard domain: traefik-board.com your app: my-app.com 0001. Add labels to traefik. Important here traefik.http.routers.traefik.middlewares=maintenance-page@docker. If you try to look for https://service-does-not-exists.com you will get friendly error page.\ntraefik: deploy: labels: - \u0026#34;traefik.enable=true\u0026#34; - \u0026#34;traefik.http.services.traefik.loadbalancer.server.port=8080\u0026#34; - \u0026#34;traefik.http.routers.traefik.rule=Host(`${traefik-board.com}`)\u0026#34; - \u0026#34;traefik.http.routers.traefik.entryPoints=websecure\u0026#34; - \u0026#34;traefik.http.routers.traefik.tls=true\u0026#34; - \u0026#34;traefik.http.routers.traefik.middlewares=maintenance-page@docker\u0026#34; 0010. Create dedicated service for error page. Make sure service would be as highly available as Traefik! I recommend to set deploy mode: global and placement: constraints: - node.role == manager. If you don\u0026rsquo;t, hello boring black page again.\nmaintenance-page: deploy: labels: - \u0026#34;traefik.enable=true\u0026#34; - \u0026#34;traefik.http.services.maintenance-page.loadbalancer.server.port=80\u0026#34; - \u0026#34;traefik.http.routers.maintenance-page.rule=HostRegexp(`{host:.+}`)\u0026#34; - \u0026#34;traefik.http.routers.maintenance-page.priority=1\u0026#34; - \u0026#34;traefik.http.routers.maintenance-page.middlewares=maintenance-page@docker\u0026#34; - \u0026#34;traefik.http.routers.maintenance-page.entrypoints=websecure\u0026#34; - \u0026#34;traefik.http.routers.maintenance-page.tls=true\u0026#34; - \u0026#34;traefik.http.middlewares.maintenance-page.errors.status=400-599\u0026#34; - \u0026#34;traefik.http.middlewares.maintenance-page.errors.service=maintenance-page\u0026#34; - \u0026#34;traefik.http.middlewares.maintenance-page.errors.query=/\u0026#34; These lines are essential. You tell the server to catch all requests and redirect them to maintenance-page service. priority=1 means \u0026ldquo;all-catcher\u0026rdquo; is not alone in the system. There is someone higher who wants to handle requests firstly, for example, \u0026ldquo;all-catcher\u0026rdquo; for http-\u0026gt;https redirect.\ntraefik.http.routers.maintenance-page.priority=1 traefik.http.routers.maintenance-page.rule=HostRegexp(`{host:.+}`) 0011. Add priority=100 to app service.\napp: deploy: labels: - \u0026#34;traefik.enable=true\u0026#34; - \u0026#34;traefik.http.routers.frontend.rule=Host(`${my-app.com}`)\u0026#34; - \u0026#34;traefik.http.services.frontend.loadbalancer.server.port=80\u0026#34; - \u0026#34;traefik.http.routers.frontend.entrypoints=websecure\u0026#34; - \u0026#34;traefik.http.routers.frontend.tls=true\u0026#34; - \u0026#34;traefik.http.routers.frontend.priority=100\u0026#34; Testing ğŸ¤¹ğŸ½â€â™€ï¸ case 1: app service goes down or updating replicas: 0:1 -\u0026gt; see maitenance page case 2: user searched for https://service-does-not-exists.com -\u0026gt; see maitenance page Further reading ğŸ‘©ğŸ½â€ğŸ’» hot thread about this topic on the Containous Community Forum nginx based error pages So, thatâ€™s all for now ğŸ˜Š. ğŸ‘©â€ğŸš€ was happy to share my experience, and I\u0026rsquo;m sure this solution will save a bunch of time for someone. Happy hacking=) ğŸ¦¾\n","permalink":"https://yuklia.github.io/posts/cloud/traefik-error-page/","summary":"What you will learn today ğŸ¦¦: what is Traefik and why I decisively recommend to use it with Docker Swarm how to show custom error page if Traefik returns 404 (service not found) How I met Traefik ğŸ˜ Traefik is a top modern reverse proxy and load balancer. I started to use it from major version 1. At that moment, I already had Docker Swarm cluster, which I began to prepare for production use, and only one thing in the coherent picture has been left: \u0026ldquo;External Load Balancer\u0026rdquo;.","title":"Custom error page in Traefik v2.x. Finally ğŸ˜»"},{"content":"Task description on Codesignal\nIâ€™ve spend decent amount of time in order to figure out that I donâ€™t need any string manipulation in this task ğŸ˜…. My first try was adding missing zeros to the beginning of number slot, convert int to str and back, then the resulting string split by 4 but no luck â€¦ It turned out that is simple math ğŸ˜€ I wanna share my solution with detailed comments â¬‡ï¸ (Time complexity O(n) )\n\u0026lt;!-- Python code --\u0026gt; \u0026#39;\u0026#39;\u0026#39; Test cases a = [123, 4, 5] b = [100, 100, 100] a = [9876, 5432, 1999] b = [1, 8001] a = [1] b = [9999, 9999, 9999, 9999, 9999, 9999] \u0026#39;\u0026#39;\u0026#39; \u0026#39;\u0026#39;\u0026#39; helper \u0026#39;\u0026#39;\u0026#39; class ListNode: def __init__(self, x): self.value = x self.next = None \u0026#39;\u0026#39;\u0026#39; helper \u0026#39;\u0026#39;\u0026#39; def array_to_linked_list(arr): if not arr: return None head = ListNode(arr[0]) root = head for i in range(1, len(arr)): new = ListNode(arr[i]) head.next = new head = new return root \u0026#39;\u0026#39;\u0026#39; helper \u0026#39;\u0026#39;\u0026#39; def linked_to_array(l): res = [] while l is not None: res.append(l.value) l = l.next return res \u0026#39;\u0026#39;\u0026#39; helper \u0026#39;\u0026#39;\u0026#39; def reverse(l): prev = None head = l while head: next = head.next head.next = prev prev = head head = next return prev def addTwoHugeNumbers(a, b): \u0026#39;\u0026#39;\u0026#39; in order to proceed with addition from right to left we need to reverse linked list and when we finish reverse it back \u0026#39;\u0026#39;\u0026#39; a = reverse(a) b = reverse(b) \u0026#39;\u0026#39;\u0026#39; init resulting linked list and buffer \u0026#39;\u0026#39;\u0026#39; head = None root = None buffer = 0 while a or b: \u0026#39;\u0026#39;\u0026#39; set 0 if NodeList element is already None \u0026#39;\u0026#39;\u0026#39; a_value = 0 if not a else a.value b_value = 0 if not b else b.value sum_els = a_value + b_value if buffer != 0: sum_els = sum_els + buffer buffer = 0 \u0026#39;\u0026#39;\u0026#39; 10000 - condition to move to another number order buffer - always 1 because 9 is the highest value in decimal numeral system \u0026#39;\u0026#39;\u0026#39; if sum_els \u0026gt; 9999: sum_els = sum_els - 10000 buffer = 1 new = ListNode(sum_els) if head is None: head = new root = head else: head.next = new head = new a = None if not a else a.next b = None if not b else b.next \u0026#39;\u0026#39;\u0026#39; if we have not empty buffer at the end of addition then add one more NodeList to the beginning \u0026#39;\u0026#39;\u0026#39; if buffer != 0: new = ListNode(buffer) head.next = new return reverse(root) \u0026#39;\u0026#39;\u0026#39; we are going to do column addition like we do at school but with only difference: addition not one by one but four by four for example: 123, 4, 5 100,100,100 \u0026#39;\u0026#39;\u0026#39; a = array_to_linked_list(a) b = array_to_linked_list(b) result = addTwoHugeNumbers(a, b) print(linked_to_array(result)) ","permalink":"https://yuklia.github.io/posts/algorithms/addtwohugenumbers/","summary":"Task description on Codesignal\nIâ€™ve spend decent amount of time in order to figure out that I donâ€™t need any string manipulation in this task ğŸ˜…. My first try was adding missing zeros to the beginning of number slot, convert int to str and back, then the resulting string split by 4 but no luck â€¦ It turned out that is simple math ğŸ˜€ I wanna share my solution with detailed comments â¬‡ï¸ (Time complexity O(n) )","title":"Solution for CodeSignal: addTwoHugeNumbers (Linked List part ğŸ‘¯)"},{"content":"1 Add tools specifically to php monitoring in order to answer the questions â¬‡ï¸ what kind of php scripts were called most of the time? what kind of php scripts took the most CPU? We choose open-source tool Pinba.\nphp pinba extension sends data over UDP in protobuf format. pinba server accumulates and processes data and send it to data storage in your choice. (In our case it is Clickhouse DB)\nIt is not a secret that the most popular script in php frameworks is index.php but this information is barely helpful. So we need some â€œCPU statistics per routeâ€.\nâ€œCPU statistics per routeâ€ means that: we have to implement one more chart in Grafana that shows CPU consumption in the matter of requested route, for example, V2\\Community\\Model.php And only after that we can give this info to developers for investigation what kind of code took the most CPU in the route: V2\\Community\\Model.php When the developer got the list of routes it is time to look inside those routes and investigate what cause high CPU. On this stage Blackfire can help. Blackfire will show you CPU Wall Time. To keep things simple, Wall Time is usually split in two main parts: the CPU Time and the I/O Time.\nThe CPU time is the amount of time the CPU was used for processing instructions. The I/O time is the time the CPU waited for input/output (I/O) operations.\nI/O time could be divided into two parts: the network and the disk.\nNetwork activity includes calls to databases like:\nMySQL, PostgreSQL, or MongoDB; HTTP calls to web services and APIs; Calls to cache systems like Redis and Memcached; Communications with services like queues, email daemons, remote filesystems; etc. Disk activity occurs when a program reads files from the filesystem, including loading code or files.\nWe need to distinguish these types of times in order to make further decisions related optimization.\nA CPU-bound programâ€™s speed depends mostly on the CPU. In other words, CPU utilization is high for long periods of time. The faster the CPU, the faster the code runs. On the contrary, an I/O bound programâ€™s speed is determined by the time spent waiting for I/O. Faster disks or a faster network improve the overall performance of I/O bound code.\n2 After that, depending on findings â¬‡ï¸ IF the reason of high CPU is I/O bound related to DB (too much time waiting for I/O ) then we should consider migrate to RDS and set up storage General Purpose (SSD) or Provisioned IOPS (SSD).\nIF the reason of high CPU : CPU-bound (which is rare case for web applications) then we should consider to optimize algorithms in code.\nto be continuedâ€¦ ğŸ‘€\n","permalink":"https://yuklia.github.io/posts/php/high-cpu/","summary":"1 Add tools specifically to php monitoring in order to answer the questions â¬‡ï¸ what kind of php scripts were called most of the time? what kind of php scripts took the most CPU? We choose open-source tool Pinba.\nphp pinba extension sends data over UDP in protobuf format. pinba server accumulates and processes data and send it to data storage in your choice. (In our case it is Clickhouse DB)","title":"How to analyse â€œhigh CPUâ€ in php on production. Part 1"},{"content":"Into ğŸ’† Pre-conditions: macOS Sierra Docker CE Version 17.06.2-ce-mac27 PHP 7.1.8 XDebug v2.5.0 PhpStorm 2017.2 If you want to set up remote debug from your container you have 2 options:\nxdebug.remote_host = %host_ip% %host_ip% â€” The IP of the machine running your IDE. Itâ€™s assumed on the same host as Docker. xdebug.remote_connect_back = on checks $_SERVER[â€˜HTTP_X_FORWARDED_FORâ€™] and $_SERVER[â€˜REMOTE_ADDRâ€™] variables to find out which IP address to use. You cannot use xdebug.remote_connect_back because it takes containersâ€™s internal IP. So xdebug.remote_host is the only option we have. Itâ€™s pretty simple to get host IP on Linux OS just look at : ifconfig \u0026gt; docker0. Moreover you can create a fixed set of IPs for both host and containers using docker network. For instance:\ndocker network create -d bridge \\ â€” subnet 192.168.0.0/24 \\ â€” gateway 192.168.0.1 \\ dockernet Now each container can connect to the host under the fixed IP 192.168.0.1 But the docker0 interface is not available for Docker in macOS. This interface is actually within HyperKit. So unfortunately there is no a reliable way of looping back to host for macOS. The only solution is to create your local IPâ€™s alias to something else : sudo ifconfig lo0 alias 10.254.254.254\nHowTo guide ğŸ‘©â€ğŸ’» sudo ifconfig lo0 alias 10.254.254.254 (optional) For permanent setting up save.plist file sudo curl -o /Library/LaunchDaemons/com.yuklia.docker_localhost_alias.plist build docker containers \u0026hellip; add server to IDE storm1 configure Debugâ€™s port in my case itâ€™s 9002. xDebug client will knock to this port. storm2 configure DBGp Proxy storm3 Bonus ğŸ° If you need to get a shell of the VM that was created by HyperKit run:\nscreen ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/tty or screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty For getting all screens run: screen -ls For exiting screen run : screen -X -S %screen_name% kill Once you get the tty running you can navigate to /var/lib/docker: storm4 Here is my Dockerfile and docker-compose versions for php:7-fpm with XDebug So thatâ€™s all for now ğŸ˜Š. Hope it will save a bunch of time for someone! I will be glad to get comments and questions. Happy hacking=) ğŸ¦¾\n","permalink":"https://yuklia.github.io/posts/php/xdebug-macos/","summary":"Into ğŸ’† Pre-conditions: macOS Sierra Docker CE Version 17.06.2-ce-mac27 PHP 7.1.8 XDebug v2.5.0 PhpStorm 2017.2 If you want to set up remote debug from your container you have 2 options:\nxdebug.remote_host = %host_ip% %host_ip% â€” The IP of the machine running your IDE. Itâ€™s assumed on the same host as Docker. xdebug.remote_connect_back = on checks $_SERVER[â€˜HTTP_X_FORWARDED_FORâ€™] and $_SERVER[â€˜REMOTE_ADDRâ€™] variables to find out which IP address to use. You cannot use xdebug.","title":"XDebug for PHP docker container on macOS"}]